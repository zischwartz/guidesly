{%extends "base-create.html"%}

{%block extrahead%}
		<script src="{{STATIC_URL}}create.js"></script>

<script type="text/javascript">
	var initial_card_json= {{card_json|safe}};
</script>
{%endblock%}

{%block header%}
	
	{%if s.brand_new%}
	Add Step
	{%else%}
	Edit Step
	{%endif%}
	
	<a href="{% url CardDetailViewById id=s.id %}"> View Step</a> | <a href="{% url EditGuide gslug=s.guide.slug %}"> View All Steps in <i>{{s.guide.title}}</i> </a>
- - - Hey {{user}}


{%endblock%}

{%block content%}
	{%load verbatim_templatetag%}
	{# <form action="" method="post" > #}
	<form action="" method="post" data-bind="submit: save">
		<div id="card_being_edited" class="{%if s.brand_new%}brand_new{%endif%}">
		{% csrf_token %}	
		<h1 class="card_title" data-bind="text:title">{{s.title}}</h1>
		<input class="card_title" data-bind="value:title, valueUpdate:'afterkeydown'" type="text" name="title" {# value="{{s.title}}"  maxlength="250" placeholder="Card Title" />
		
		<div data-bind="template:{name: 'imageTemplate',  foreach: cardViewModel.staticelements}"> </div>

		<input type="hidden" name="card_number" value="{%firstof s.card_number '' %}" id="id_card_number" />
		<input type="hidden" name="slug" value="{{s.slug}}" id="id_slug" />
		<input type="hidden" name="guide" id="id_guide" value="{{s.guide.id}}">

		{% verbatim %} 		
			<script id='imageTemplate' type='text/html'>
				<div class="image_wrap">
					<img src="${file.file}"> 
					<div class="image_caption">	${title}</div>
				</div>
			</script>
		{%endverbatim%}
	
		<textarea placeholder='Card text goes here' class="card_text" name="text" data-bind="value:text">{{s.text}}</textarea>
	
		<br>
	
		{%for el in current_interactive_elements%}
			<div class="an_element an_interactive_el" data-id="{{el.id}}" data-title="{{el.button_text}}">
				{%include el.el_template%}<br>
			</div>
		{%endfor%}
	
		</div> {# end #card_being_edited #}
	<input class="button" type="submit" value="Save Card" name ="card_sub_save"/>
	{# <input class="button" type="submit" value="Save &amp; Add Another Card" name="card_sub_add" /> #}
</form> {# end card form #}

{%endblock%}


{%block sidebar%}




<div id="card_element_toolbar">

	<h3 id="add_static">Add Media</h3>
	<div id="add_media_group">
		<h4 data-media_type="image">Add Image</h4>
		<h4 data-media_type="video">Add Video</h4>
		<h4 data-media_type="audio">Add Audio</h4>
		<h4 data-media_type="other">Add Other</h4>
		<div class="userfiles" data-bind="template:{name: 'mediaTemplate',  foreach: cardViewModel.media_files}"></div>
	</div>
	
	<h3 id="add_static">Add an Input</h3>
	<div id="add_interactive_group">
		<h4>Add Button</h4>
		<h4>Add Timer</h4>
		<h4>Add Text Question</h4>
	</div>
	
	<h3 id="add_static">Edit Card Element</h3>

</div> {# end #card_element_toolbar #}
      {# <button data-bind='click: makeOlder'>Make older</button> #}


	{% verbatim %} 		
		<script id='mediaTemplate' type='text/html'>
			<br>
			<div data-bind='click: cardViewModel.add2card' class="media"> 
				<img src="${file}">
				<div class="image_caption">${slug}</div>

			</div>
		</script>
	{%endverbatim%}
	
	
{%endblock%}
